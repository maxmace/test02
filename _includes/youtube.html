{% capture unique_id %}
{{ include.id }}-{{ include.start | default: '0' }}-{{ include.thumb | slugify }}
{% endcapture %}

<div class="video-block">
  <div class="video-container" id="container-{{ unique_id | strip | strip_newlines }}">

    {% if include.thumb %}
      <div class="video-thumb-wrapper" 
           onclick="loadVideo('{{ include.id }}', '{{ include.start }}', '{{ include.end }}', 'container-{{ unique_id | strip | strip_newlines }}')">
        
        <img src="{{ include.thumb | relative_url }}" 
             alt="{{ include.title | escape }}" 
             class="img-responsive">
        
        <div class="play-overlay"></div>
      </div>

    {% else %}
      <iframe 
        src="https://www.youtube.com/embed/{{ include.id }}?rel=0{% if include.start %}&start={{ include.start }}{% endif %}{% if include.end %}&end={{ include.end }}{% endif %}" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen
        style="position:absolute; top:0; left:0; width:100%; height:100%;">
      </iframe>
    {% endif %}

  </div>

  {% if include.title %}
    <div class="video-caption">
      <strong>Video:</strong> {{ include.title }}
    </div>
  {% endif %}
</div>

<script>
if (!window.loadVideo) {
  window.loadVideo = function(id, start, end, containerId) {
    // We use trim() to handle any hidden whitespace from Liquid formatting
    var targetId = containerId.trim();
    var container = document.getElementById(targetId);
    
    if (!container) {
      console.error("YouTube Player Error: Could not find container ID:", targetId);
      return;
    }

    var url = "https://www.youtube.com/embed/" + id + "?autoplay=1&rel=0";
    if (start && start !== "") url += "&start=" + start;
    if (end && end !== "") url += "&end=" + end;

    container.innerHTML = 
      '<iframe src="' + url + '" ' +
      'frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" ' +
      'allowfullscreen style="position:absolute; top:0; left:0; width:100%; height:100%;"></iframe>';
  };
}
</script>
